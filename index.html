<!DOCTYPE html>
<html>
  <head>
    <link rel="stylesheet" type="text/css" href="reset.css">
    <link rel="stylesheet" type="text/css" href="style.css">
    <script src="http://fb.me/react-0.11.2.js"></script>
    <script src="http://fb.me/JSXTransformer-0.11.2.js"></script>
    <script src="http://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.7.0/underscore-min.js"></script>
    <script src="http://cdnjs.cloudflare.com/ajax/libs/backbone.js/1.1.2/backbone-min.js"></script>
    <script type="text/javascript" src="sudoku.js"></script>
<!-- 
    <script src="./sudoku_model.js"></script>
     -->
  </head>
  <body>
    <div id="sudoku">
    </div>
    <script type="text/jsx">
    /** @jsx React.DOM */

    var sudoku = React.createClass({
      stringifyBoard: function(board) {
        var boardString = ""
        board.models.forEach(function(cell){
          boardString += cell.attributes.currentValue
        })
        console.log(boardString)
        return boardString
      },

      initiateGame: function(boardString) {
        Sudoku.board = Sudoku.BoardBuilder(boardString).buildBoard
        Sudoku.board.on('change', function(){
          console.log("fuch you kouch")
          var boardString = this.stringifyBoard(Sudoku.board)
          // console.log(boardString)
          this.setState({data: boardString})
        }.bind(this))
        var solution = Sudoku.Solver(Sudoku.board)
        console.log(Sudoku.board)
        // var boardString = this.stringifyBoard(Sudoku.board)
        // this.setState({data: boardString})
        // console.log(Sudoku.board)
        // debugger
      },

      getInitialState: function(){
        return {data: 'Waiting for a game string'}
      },

      componentDidMount: function(){

      },

      render: function(){
        return (
          <div>
            <h1>Sudoku</h1>
            <sudokuBar data={this.state.data} />
            <sudokuForm onGameSubmit={this.initiateGame} />
          </div>
        )
      }
    })

    var sudokuBar = React.createClass({
      render: function() {
        return (
          <p>{this.props.data}</p>
        )
      }
    })

    var sudokuForm = React.createClass({
      handleSubmit: function(event) {
        event.preventDefault()
        var sudokuGame = this.refs.sudokuGame.getDOMNode().value.trim()
        if (!sudokuGame) return
        this.props.onGameSubmit(sudokuGame)
        this.refs.sudokuGame.getDOMNode().value = ''
      },

      render: function() {
        return (
          <form onSubmit={this.handleSubmit}>
            <input type="text" placeholder="enter sudoku game" ref="sudokuGame" />
            <input type="submit" value="Solve!" />
          </form>
        )
      }
    })

    React.renderComponent(
      <sudoku />, document.getElementById('sudoku')
    )
    </script>
  </body>
</html>

